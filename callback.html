<html>
    <head>
        <title>Logging in...</title>
    </head>
    <body>
        <p id="info">Logging in...</p>

        <script type="module">
            const requestUser = () => fetch("http://localhost:8001/user", {
                credentials: "include"
            });

            requestUser();
            load();

            async function load() {
                const userReq = await requestUser();
                const user = await userReq.json();

                if (user.error) {
                    switch (user.error) {
                        case "not_logged_in":
                            window.location.href = "/";
                            break;
                        default:
                            console.log(user.error);
                            await load();
                            break;
                    }
                    return;
                }

                document.getElementById("info").innerHTML = JSON.stringify(user);
            }
        </script>
    </body>
</html>