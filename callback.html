<html>
    <head>
        <title>Logging in...</title>
    </head>
    <body>
        <p id="info">Logging in...</p>

        <script type="module">
            load();

            async function load() {
                try {
                    const userReq = await fetch("http://localhost:8001/user", {
                        credentials: "include"
                    });
                    const user = await userReq.json();

                    if (user.error) {
                        switch (user.error) {
                            case "not_logged_in":
                                window.location.href = "/";
                                break;
                            default:
                                console.log(user.error);
                                setTimeout(() => {
                                    load();
                                }, 1000);
                                break;
                        }
                        return;
                    }

                    document.getElementById("info").innerHTML = JSON.stringify(user);
                } catch(err) {
                    console.error(err);
                    setTimeout(() => {
                        load();
                    }, 1000);
                }
            }
        </script>
    </body>
</html>