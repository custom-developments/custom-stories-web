<html>
    <head>
        <title>guilds</title>
    </head>
    <body>
        <p><a href="/">Home</a></p>
        <p><a href="http://localhost:8001/oauth2/logout">Logout</a></p>

        <p id="info">Getting servers...</p>
        <div id="content"></div>

        <script src="/script.js"></script>
        <script>
            load(info => {
                document.getElementById("info").innerHTML = JSON.stringify(info);

                const guilds = [];

                for (const guild of info.guilds.manage.concat(info.guilds.invite)) {
                    guilds.push(`
                        <a href="/manage.html#${guild.id}">
                            <img src="${
                                guild.icon ? 
                                `https://cdn.discordapp.com/icons/${guild.id}/${guild.icon}.png` :
                                `https://customrpg.xyz/assets/images/logo.png`
                            }" width=100>
                            
                            ${guild.name} (click to ${info.guilds.manage.find(g => guild.id === g.id) ? "manage" : "invite"})
                        </a>
                    `);
                }

                document.getElementById("content").innerHTML = `
                    <!-- Make sure to check if the user doesn't have an avatar too. -->
                    <img src="https://cdn.discordapp.com/avatars/${info.user.id}/${info.user.avatar}">

                    <h3>Hey, ${escapeHTML(info.user.username)}</h3><br><br>

                    ${guilds.join("<br><br>")}
                `;
            });
        </script>
    </body>
</html>